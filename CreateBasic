#!/usr/bin/perl -w

use DBI;
use strict;

my $i;
my $rst;
my @count;
my @twoCol;

###########################################
###########################################
##
## Checking if table exists.
## If it doesn't then it creates the table
##
###########################################
###########################################
                                       ####

my $dbh = DBI->connect ("dbi:SQLite:DB/DBPicross.sqlite") || die "Cannot connect: $dbi::errstr";
my $strSQL = qq {
		SELECT
			count(name)
		FROM
			sqlite_master
		WHERE
			type = 'table'
			AND name = 'tblPixelBoard'
		};
@count = $dbh->selectrow_array( $strSQL );
print "tblPixelBoard table present: ". $count[0] ."\n";

if ($count[0] == 0)
{
	my @difficulty;
	$strSQL = qq {
			CREATE TABLE
				tblPixelBoard
				(
					PixelBoardNumber INTEGER PRIMARY KEY NOT NULL,
					GameBoard TEXT,
					Name TEXT,
					Width INTEGER,
					Height INTEGER,
					HiddenCount INTEGER,
					DifficultyNumber INTEGER,
					CreatedBy TEXT,
					DateCreated DATETIME DEFAULT CURRENT_TIMESTAMP
				)
			};
	$dbh->do( $strSQL );
	print "Creating table tblPixelBoard\n";
	
	$strSQL = qq {
		CREATE TABLE
			tblDifficulty
			(
				DifficultyNumber INTEGER PRIMARY KEY NOT NULL,
				Ordinal INTEGER,
				Name TEXT
			)
	}; #end strSQL
	$dbh->do( $strSQL );
	
	print "Creating table tblDifficulty\n";
	
	push( @difficulty, "Easy" );
	push( @difficulty, "Medium" );
	push( @difficulty, "Hard" );
	
	$i=0;
	foreach (@difficulty)
	{
		$i++;
		$strSQL = qq {
			INSERT INTO tblDifficulty (Name, Ordinal)
			VALUES ('$_','$i')
		}; # end strSQL
		$dbh->do( $strSQL );
	}
}
                                       ####
###########################################
###########################################

if ($count[0] == 0)
{
	MakeEasy();
	MakeMedium();
	MakeHard(); # heheh >:-D
}

sub MakeEasy
{
	my $board;
	print "Building pre-defined easy difficulty boards\n";
	
	$board = qq {
			10001
			01010
			00100
			01010
			10001
		};
	AddBoard($board, "Just X", 1);
	
	$board = qq {
			11111
			10001
			10001
			10001
			11111
		};
	AddBoard($board, "Picture Frame",1);
	
	$board = qq {
			00000
			11111
			10101
			11111
			00000
		};
	AddBoard($board,"Squashed I",1);

	$board = qq {
			11111
			00010
			00100
			01000
			11111
		};
	AddBoard($board,"Just Z",1);

	$board = qq {
			10000
			10111
			10101
			10001
			11111
		};
	AddBoard($board,"Spiral",1);

	$board = qq {
			10011
			10101
			10101
			10101
			11001
		};
	AddBoard($board,"Wavy",1);
	
	$board = qq {
			00100
			00100
			11111
			01010
			10001
		};
	AddBoard($board,"Star",1);
	
	$board = qq {
			11111
			00100
			10101
			10101
			10101
		};
	AddBoard($board,"T with Company",1);

	$board = qq {
			11011
			10101
			11011
			00100
			11011
		};
	AddBoard($board,"Is that an owl?",1);

	$board = qq {
			10001
			00111
			00110
			01010
			10001
		};
	AddBoard($board,"Tricky Nothing",1);
}

sub MakeMedium
{
	my $board;
	print "Building pre-defined medium difficulty boards\n";
	
	$board = qq {
			0000000000
			0000110000
			0000110000
			0000110000
			0111111110
			0111111110
			0000110000
			0000110000
			0000110000
			0000000000
		};
	AddBoard($board,"Cross\@u",2);
	
	
	$board = qq {
			1110110000
			1110110110
			1110000110
			0001110000
			0001110000
			0001110000
			1100001110
			1101101110
			0001101110
			0000000000
		};
	AddBoard($board,"Sortachecked",2);
	
	$board = qq {
			0001000000
			0011100000
			0111110000
			0000100000
			0001110000
			0011111000
			0000010000
			0000111000
			0001111100
			0000000000
		};
	AddBoard($board,"In Formation",2);
	
	$board = qq {
			0000100101
			0001110010
			0000101001
			0000010100
			0000010100
			0000110110
			0100101010
			1110110110
			1110101010
			1110110110
		};
	AddBoard($board,"CityScape",2);
	
	$board = qq {
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
		};
	AddBoard($board,"Tricky",2);
	
	$board = qq {
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
		};
	AddBoard($board,"Tricky",2);
	
	$board = qq {
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
		};
	AddBoard($board,"Tricky",2);
	
	$board = qq {
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
		};
	AddBoard($board,"Tricky",2);
	
	$board = qq {
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
		};
	AddBoard($board,"Tricky",2);
	
	$board = qq {
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
			0000000000
		};
	AddBoard($board,"Tricky",2);
}

sub MakeHard
{
	##
	## This subroutine is aware of it's name...
	##
	
	my $board;
	print "Building pre-defined hard difficulty boards\n";
	
	$board = qq {
			0000000001110000000011111
			0000000111111100000011111
			0000011110001111000010000
			0000011000000011000011111
			0000011000000011000000000
			0000011000000011000000000
			0000011110001111000000000
			0000000111111100000011111
			0000000001110000000010000
			0000000000000000000011111
			1111111110000000000010000
			0010011010000010000011111
			0010011010000111000010000
			0010011010001111100010000
			0010011010011111110011111
		};
	AddBoard($board,"Strange Formations",3);
	
	$board = qq {
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
		};
	AddBoard($board,"Tricky",3);
	
	$board = qq {
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
		};
	AddBoard($board,"Tricky",3);
	
	$board = qq {
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
		};
	AddBoard($board,"Tricky",3);
	
	$board = qq {
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
		};
	AddBoard($board,"Tricky",3);
	
	$board = qq {
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
		};
	AddBoard($board,"Tricky",3);
	
	$board = qq {
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
		};
	AddBoard($board,"Tricky",3);
	
	$board = qq {
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
		};
	AddBoard($board,"Tricky",3);
	
	$board = qq {
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
		};
	AddBoard($board,"Tricky",3);
	
	$board = qq {
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
			0000000000000000000000000
		};
	AddBoard($board,"Tricky",3);
}

sub AddBoard()
{
	my ($board, $description, $difficulty) = ($_[0], $_[1], $_[2]);
	
	$board =~ s/^\n//g;
	$board =~ s/[\t]+//g;
	$board =~ s/\n$//g;
	
	my $width = getWidth($board);
	my $height = getHeight($board);
	my $hiddenCount = getHiddenCount($board);
	
	$strSQL = qq {
		INSERT INTO tblPixelBoard (
			GameBoard,
			Name,
			Width,
			Height,
			HiddenCount,
			DifficultyNumber,
			CreatedBy
		)
		VALUES (
			'$board',
			'$description',
			'$width',
			'$height',
			'$hiddenCount',
			'$difficulty',
			'waggy'
		)
	}; # end strSQL
	$dbh->do( $strSQL );
}

sub Read()
{
	$strSQL = qq{
		SELECT
			*
		FROM
			tblPixelBoard
	};
	$rst = $dbh->selectall_arrayref( $strSQL );
	foreach (@$rst)
	{
		print "$_->[1]\n";
	}

	$dbh->disconnect;
}

sub getWidth()
{
	my @row = split("\n", shift);
	return length($row[0]);
}

sub getHeight()
{
	return my $rows = my @size = split("\n", shift);
}

sub getHiddenCount()
{
	return shift =~ tr/1/1/;
}

#~ Read;
